Based on code from Justin Tan (justin.tanwk@gmail.com)

